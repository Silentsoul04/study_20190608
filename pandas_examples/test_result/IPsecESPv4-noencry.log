ANVL version 8.80.1.28 (Linux). Copyright (c) (2019) Ixia.  All Rights reserved.
ANVL Machine info: 2.6.18-348.el5PAE
                   Intel(R) Core(TM) i7-3770 CPU @ 3.40GHz
                   Total Memory 8197416 kB RAM. Free Memory 6724844 kB RAM.
                   025650-678a76-daddf8-a95c
ANVL command line: /opt/Ixia/IxANVL880/ANVL-SRC/Bin/ix86-Linux/anvl -l low -f /opt/Ixia/IxANVL880/ANVL-SRC/DocUserQ35/anvlipsecesp-noencry ipsec-esp 8.4 8.6 22-23 26.7 


# Parameter File: /opt/Ixia/IxANVL880/ANVL-SRC/DocUserQ35/anvlipsecesp-noencry.prm 

Reboot Time                              300                 # (0x0000012C)
Reboot Command                           ""
Post suite Command                       "./DocScriptQ35/IPSEC-ESP/IPSECESPpostsuite.exp $ANVL_DUTHOSTNAME"
DUT Verification Returns FALSE on Success False
DUT Verification Return Value on Success 1                   # (0x00000001)
DUT Configure Check Return Value         False
Pre Test Command                         ""
Post Test Command                        ""
Are You There Command                    ""
Are You There Tolerance Time             1                   # (0x00000001)
IPSec ESP Anti Replay Window Size        32                  # (0x00000020)
IPSec ESP DUT Supports Configurable Lifetime True
IPSec ESP SA Lifetime Seconds            120                 # (0x00000078)
IPSec ESP SA Lifetime Bytes              1024                # (0x00000400)
IPSec ESP DUT Supports Transport Mode    True
IPSec DUT Supports Configurable Outbound SPD True
IPSec DUT Supports Anti Replay           True
IPSec Wait Time                          10                  # (0x0000000A)
IPSec DUT Supports Configurable Inbound SPD True
IPSec DUT Supports Explicit Congestion Notification True
IPSec DUT Supports Traffic Flow Confidentiality True
IPSec DUT ECN Configure Command          "./DocScriptQ35/IPSEC-ESP/ipsec-ecn-configure-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set Outbound SPD for ICMP Type And Code Command "./DocScriptQ35/IPSEC-ESP/ipsec-set-outbound-spd-icmp-type-code-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Add Outbound SPD Policy for Host Command "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-host-command-26-7special.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec DUT Verify Audit Log for Bad SPI Command "./DocScriptQ35/IPSEC-ESP/ipsec-verify-audit-bad-spi-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ESP DUT TFC Configure Command      "./DocScriptQ35/IPSEC-ESP/ipsec-dut-tfc-configure-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ESP Set SA Lifetime Seconds Command "./DocScriptQ35/IPSEC-ESP/ipsec-esp-set-sa-lifetime-seconds-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ESP Suite Setup Command            "./DocScriptQ35/IPSEC-ESP/ipsec-esp-suite-setup-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ESP Reset IP Security Command      "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ESP Set SA Lifetime Bytes Command  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-set-sa-lifetime-bytes-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ESP DUT Mode Configure Command     "./DocScriptQ35/IPSEC-ESP/ipsec-esp-configure-dut-mode-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ESP Reset SA with Anti Replay Command "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-sa-with-anti-replay-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set Inbound SPD for Protocol and Port Command "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set Outbound SPD for Protocol Command "./DocScriptQ35/IPSEC-ESP/ipsec-set-outbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set Inbound SPD for Host Command   "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set Inbound SPD for Protocol Command "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Add Inbound SPD Policy for Subnet Command "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Add Inbound SPD Policy for Host Command "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set DF Bit processing Command      "./DocScriptQ35/IPSEC-ESP/ipsec-set-df-bit-processing-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Reset DF Bit processing Command    "./DocScriptQ35/IPSEC-ESP/ipsec-reset-df-bit-processing-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec DUT Send Ping Command              "./DocScriptQ35/IPSEC-ESP/ipsec-dut-send-ping-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set Outbound SPD for Host Command  "./DocScriptQ35/IPSEC-ESP/ipsec-set-outbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Add Outbound SPD Policy for Subnet Command "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Set Outbound SPD for Protocol and Port Command "./DocScriptQ35/IPSEC-ESP/ipsec-set-outbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec Remove ANVL from SA Command        "./DocScriptQ35/IPSEC-ESP/ipsec-remove-anvl-from-sa-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ANVL Clear SPD Command             "./DocScriptQ35/IPSEC-ESP/ipsec-anvl-clear-spd-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec ANVL Clear SA Command              "./DocScriptQ35/IPSEC-ESP/ipsec-anvl-clear-sa-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IPSec DF Bit Processing                  COPY
IPSec DUT Supports Configurable DF Bit   True
IPSec Check Mode Command                 "./DocScriptQ35/IPSEC-ESP/ipsec-check-mode-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
IKE Listen Time                          10                  # (0x0000000A)

# Parameter File End.

Number of unused prefixes in config file is set to zero
Setting number of unused prefixes to default value 255

# Configuration File: /opt/Ixia/IxANVL880/ANVL-SRC/DocUserQ35/anvlipsecesp-noencry.cfg

License Server Location                  
DUT Hostname                             128.224.166.238
DUT Username                             
DUT Prompt                               ""
DUT Password Level0                      
DUT Password Level1                      
DUT Custom Entry1                        
DUT Custom Entry2                        
DUT Custom Entry3                        

Ethernet Interface                       eth3
  Interface Enabled                        True
  DUT Interface                            ""
  DUT MAC Address                          00:15:17:C8:90:28
  IP Encapsulation Type                    Ethernet
  IP DUT Address                           30.1.1.5
  IP ANVL Address                          30.1.1.150
  IP Subnet Mask                           255.255.255.0
  IP Broadcast Address                     30.1.1.255

Ethernet Interface                       eth4
  Interface Enabled                        True
  DUT Interface                            ""
  DUT MAC Address                          00:15:17:C8:90:29
  IP Encapsulation Type                    Ethernet
  IP DUT Address                           40.1.1.5
  IP ANVL Address                          40.1.1.150
  IP Subnet Mask                           255.255.255.0
  IP Broadcast Address                     40.1.1.255

IPSec Interface                          eth3
  Interface Enabled                        True
  DUT Interface                            ""
  DUT MAC Address                          00:00:00:00:00:00
  IPSec IP Remote Host Address             30.1.1.150
  IPSec IP Local Host Address              40.1.1.150
  IPSec IP Encapsulation                   v4Ov4
  IPSec Configuration                      Manual
  IPSec IPv6 Remote Host Address           ::
  IPSec IPv6 Local Host Address            ::
  IPSec ANVL SPI                           768               # (0x00000300)
  IPSec DUT SPI                            770               # (0x00000302)
  IPSec Authentication Algorithm           HMAC_MD5_96
  IPSec Authentication Key                 66306630663066306630663066302222
  IKE ISAKMP SA Encryption Algorithm       DES_CBC
  IKE ISAKMP SA Hashing Algorithm          SHA
  IKE ISAKMP SA Authentication Method      PRESHARED_KEY
  IKE ISAKMP SA Group Description          MODP768
  IKE IPSec SA Transform ID                ESP_DES
  IKE IPSec SA Group Description           MODP1024
  IKE IPSec SA Authentication Algorithm    HMAC_MD5
  IPSec Encryption Algorithm               NULL_ENCRYPTION
  IPSec Encryption Key                     
  IPSec Encryption IV                      
  IKE Pre-Shared Key                       abcdefghijklmnopqrstuvwx

# Configuration File End.
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-suite-setup-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd sysvar set -co ipnet.inet.AcceptSourceRoute "1"
sysvar: ipnet.inet.AcceptSourceRoute=1 ok
-> ipAttach 0,"gei"
value = 0 = 0x0
-> cmd ifconfig gei0 inet add 30.1.1.5 netmask 255.255.255.0 up
-> ipAttach 1,"gei"
value = 0 = 0x0
-> cmd ifconfig gei1 inet add 40.1.1.5 netmask 255.255.255.0 up
-> cmd ifconfig -a
lo0	Link type:Local loopback
	inet 127.0.0.1  mask 255.255.255.255
	inet6 unicast fe80::1%lo0  prefixlen 64  automatic
	inet6 unicast ::1  prefixlen 128
	UP RUNNING LOOPBACK MULTICAST NOARP ALLMULTI 
	MTU:1500  metric:1  VR:0  ifindex:1
	RX packets:835998 mcast:3388 errors:0 dropped:0
	TX packets:835998 mcast:3388 errors:0
	collisions:0 unsupported proto:0
	RX bytes:62295461 (62 M)  TX bytes:62295461 (62 M)

gei2	Link type:Ethernet  HWaddr 00:25:90:04:e2:de
	capabilities: TXCSUM TX6CSUM VLAN_MTU VLAN_TXHWTAG VLAN_RXHWTAG 
	inet 128.224.166.238  mask 255.255.254.0  broadcast 128.224.167.255
	inet6 unicast fe80::225:90ff:fe04:e2de%gei2  prefixlen 64  automatic
	UP RUNNING SIMPLEX BROADCAST MULTICAST 
	MTU:1500  metric:1  VR:0  ifindex:2
	RX packets:319006 mcast:17481 errors:0 dropped:1807
	TX packets:42696 mcast:1117 errors:0
	collisions:0 unsupported proto:0
	RX bytes:21387133 (21 M)  TX bytes:4605270 (4605 k)

gei0	Link type:Ethernet  HWaddr 00:15:17:c8:90:28
	capabilities: TXCSUM TX6CSUM VLAN_MTU VLAN_TXHWTAG VLAN_RXHWTAG 
	inet 30.1.1.5  mask 255.255.255.0  broadcast 30.1.1.255
	inet6 unicast fe80::215:17ff:fec8:9028%gei0  prefixlen 64  automatic
	UP RUNNING SIMPLEX BROADCAST MULTICAST 
	MTU:1500  metric:1  VR:0  ifindex:37
	RX packets:0 mcast:0 errors:0 dropped:0
	TX packets:10 mcast:5 errors:0
	collisions:0 unsupported proto:0
	RX bytes:0  TX bytes:648

gei1	Link type:Ethernet  HWaddr 00:15:17:c8:90:29
	capabilities: TXCSUM TX6CSUM VLAN_MTU VLAN_TXHWTAG VLAN_RXHWTAG 
	inet 40.1.1.5  mask 255.255.255.0  broadcast 40.1.1.255
	inet6 unicast fe80::215:17ff:fec8:9029%gei1  prefixlen 64  automatic
	UP RUNNING SIMPLEX BROADCAST MULTICAST 
	MTU:1300  metric:1  VR:0  ifindex:38
	RX packets:0 mcast:0 errors:0 dropped:0
	TX packets:10 mcast:5 errors:0
	collisions:0 unsupported proto:0
	RX bytes:0  TX bytes:648

-> exit
Au revoir!
Connection closed by foreign host.
FF:FF:FF:FF:FF:FF < 00:1B:21:7D:57:BA ARP Req 30.1.1.5

00:1B:21:7D:57:BA < 00:15:17:C8:90:28 ARP Rsp 30.1.1.150

Device Under Test found at 30.1.1.5 as 00:15:17:C8:90:28
FF:FF:FF:FF:FF:FF < 00:1B:21:7D:57:BB ARP Req 40.1.1.5

00:1B:21:7D:57:BB < 00:15:17:C8:90:29 ARP Rsp 40.1.1.150

Device Under Test found at 40.1.1.5 as 00:15:17:C8:90:29

This test suite tests statements from:
ANVL Test Suite IPSec Encapsulating Security Payload
RFC 4301: 'Security Architecture for the Internet Protocol'
(S. Ken BBN Corp, R. Atkinson @Home Network, November 1998)
RFC 2403: 'The Use of HMAC-MD5-96 within ESP and AH'
(C. Madson Cisco Systems Inc., R. Glenn NIST, November 1998)
RFC 2404: 'The Use of HMAC-SHA-1-96 within ESP and AH'
(C. Madson Cisco Systems Inc., R. Glenn NIST, November 1998)
RFC 2405: 'The ESP DES-CBC Cipher Algorithm With Explicit IV
(C. Madson Cisco Systems Inc., N. Doraswamy Bay Networks, Inc.,
November 1998)
RFC 4303: 'IP Encapsulating Security Payload'
(S. Ken BBN Corp, R. Atkinson @Home Network, November 1998)


ANVL Test Suite Required Setup:
RFC 4106: 'The Use of Galois/Counter Mode (GCM)in IPsec
Encapsulating Security Payload
(J. Viega Secure Software, Inc., D. McGrew Cisco Systems,
Inc., June 2005)
This suite expects to be running against an IPSec gateway. The
testing requires that the machine ANVL is running on is connected
to 2 interfaces that are connected to the device under test.

The ANVL config file must contain 2 IP interfaces
and also one IPSec interface on one of 2 ports 
The DUT should be configured exactly as it is indicated in the
configuration file. There are a number of parameters
controlling this suite that need to be setup for a completely
automated run.


This suite should be run on an isolated test net which contains
only the Device Under Test (DUT).
Some tests may flood the network, some may erroneously fail if other
devices are on the network, and some may send packets which can
crash other devices on the network.

>> IPSEC-ESP-8.4
TEST_DESCRIPTION
IPSec MUST set the Pad Length and Next Header in the ESP Trailer such
that they are right aligned within a 4-byte word, while using NULL
Encryption Algo.
TEST_REFERENCE
RFC 4303 s2.4 p14 Padding
TEST_METHOD
- ANVL: Send an IPv4 ICMP Echo Request from Local Host with
        <n> bytes of ULP Information
-  DUT: Forward the ESP-secured IPv4 ICMP Echo Request to Remote Host
        with Padding field in ESP Trailer set such that Pad-Length
        and Next-Header fields are right-aligned within a 4-byte word
- CASE: <n> = 6 (needs 4n bytes Padding, n>=0)
- CASE: <n> = 5 (needs (4n+1) bytes Padding, n>=0)
- CASE: <n> = 4 (needs (4n+2) bytes Padding, n>=0)
- CASE: <n> = 3 (needs (4n+3) bytes Padding, n>=0)
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1852  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1853  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1854  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1855  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1856  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1381] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1382] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1380] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1383] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


Case 1: send ICMP Echo Request with 6 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 34 bytes
IP: Identification         = 0x0001 (1)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x4010 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0001 (1)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [6 bytes] ---
ICMP:  41 4E 56 4C 20 54                                 ANVL T
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [12 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00               ............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0x8A89 (35465)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0xB25A (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000001 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 34 bytes
IP: Identification         = 0x0001 (1)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x4010 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0001 (1)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [6 bytes] ---
ICMP:  41 4E 56 4C 20 54                                 ANVL T
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP:
ESP: Pad Length               = 0 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  45 EF F8 E3 24 01 A1 5A E7 FE 97 EB               E...$..Z....
ESP: --- Authentication Data End ---
ESP:

Correctly received Pad Length field in ESP Trailer: 0
received on interface eth3 (30.1.1.150) (Remote Host)


Case 2: send ICMP Echo Request with 5 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 33 bytes
IP: Identification         = 0x0002 (2)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x4063 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0002 (2)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [5 bytes] ---
ICMP:  41 4E 56 4C 20                                    ANVL 
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [13 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00            .............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0x819B (33179)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0xBB48 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000002 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 33 bytes
IP: Identification         = 0x0002 (2)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x4063 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0002 (2)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [5 bytes] ---
ICMP:  41 4E 56 4C 20                                    ANVL 
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [1 bytes] ---
ESP:  01                                                .
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 1 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  67 9D DC 8C 63 CE E2 37 39 8D CF 3B               g...c..79..;
ESP: --- Authentication Data End ---
ESP:

Correctly received Pad Length field in ESP Trailer: 1
received on interface eth3 (30.1.1.150) (Remote Host)


Case 3: send ICMP Echo Request with 4 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 32 bytes
IP: Identification         = 0x0003 (3)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x6062 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0003 (3)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [4 bytes] ---
ICMP:  41 4E 56 4C                                       ANVL
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [14 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00         ..............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0xBCB0 (48304)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x8033 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000003 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 32 bytes
IP: Identification         = 0x0003 (3)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x6062 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0003 (3)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [4 bytes] ---
ICMP:  41 4E 56 4C                                       ANVL
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  A4 B8 63 8F AB 1A 3A EA E4 4E 94 92               ..c...:..N..
ESP: --- Authentication Data End ---
ESP:

Correctly received Pad Length field in ESP Trailer: 2
received on interface eth3 (30.1.1.150) (Remote Host)


Case 4: send ICMP Echo Request with 3 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 31 bytes
IP: Identification         = 0x0004 (4)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x60AD (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0004 (4)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [3 bytes] ---
ICMP:  41 4E 56                                          ANV
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [15 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00      ...............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0x756C (30060)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0xC777 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000004 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 31 bytes
IP: Identification         = 0x0004 (4)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32AD (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x60AD (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0004 (4)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [3 bytes] ---
ICMP:  41 4E 56                                          ANV
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [3 bytes] ---
ESP:  01 02 03                                          ...
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 3 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  9D 62 2C CC EC D1 20 B0 6F 80 BE 72               .b,... .o..r
ESP: --- Authentication Data End ---
ESP:

Correctly received Pad Length field in ESP Trailer: 3
received on interface eth3 (30.1.1.150) (Remote Host)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-8.4: Passed

>> IPSEC-ESP-8.6
TEST_DESCRIPTION
IPSec MUST set the Padding in ESP Trailer, to a sequence of
monotonically increasing integers starting from 1, while using
NULL Encryption.
TEST_REFERENCE
RFC 4303 s2.4 p15 Padding; RFC 2405 s3.1 p3 ESP Payload
TEST_METHOD
- ANVL: Send an ICMP Echo Request from Local Host with <n> bytes of
        ULP Information
-  DUT: Forward the corresponding ESP-secured IPv4 ICMP Echo Request
        to Remote Host with Padding field in ESP trailer set such
        that the Padding field contains a sequence of monotonically
        increasing integers starting from 1
- CASE: <n> = 6 (needs 4n bytes Padding, n>=0)
- CASE: <n> = 5 (needs (4n+1) bytes Padding, n>=0)
- CASE: <n> = 4 (needs (4n+2) bytes Padding, n>=0)
- CASE: <n> = 3 (needs (4n+3) bytes Padding, n>=0)
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1857  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1858  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1859  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1860  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1861  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1385] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1386] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1384] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1387] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


Case 1: send ICMP Echo Request with 6 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 34 bytes
IP: Identification         = 0x0005 (5)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x400C (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0005 (5)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [6 bytes] ---
ICMP:  41 4E 56 4C 20 54                                 ANVL T
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [12 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00               ............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0x662B (26155)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0xD6B8 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000001 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 34 bytes
IP: Identification         = 0x0005 (5)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x400C (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0005 (5)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [6 bytes] ---
ICMP:  41 4E 56 4C 20 54                                 ANVL T
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP:
ESP: Pad Length               = 0 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  55 64 C0 49 CE 80 4E 2E 42 D6 CB E7               Ud.I..N.B...
ESP: --- Authentication Data End ---
ESP:

Correctly received Padding field in ESP Trailer:
received on interface eth3 (30.1.1.150) (Remote Host)


Case 2: send ICMP Echo Request with 5 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 33 bytes
IP: Identification         = 0x0006 (6)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x405F (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0006 (6)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [5 bytes] ---
ICMP:  41 4E 56 4C 20                                    ANVL 
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [13 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00            .............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0xE6CA (59082)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x5619 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000002 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 33 bytes
IP: Identification         = 0x0006 (6)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x405F (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0006 (6)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [5 bytes] ---
ICMP:  41 4E 56 4C 20                                    ANVL 
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [1 bytes] ---
ESP:  01                                                .
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 1 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  91 4C 02 35 BC 95 BF E9 2A DF 15 27               .L.5....*..'
ESP: --- Authentication Data End ---
ESP:

Correctly received Padding field in ESP Trailer:01                                                .
received on interface eth3 (30.1.1.150) (Remote Host)


Case 3: send ICMP Echo Request with 4 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 32 bytes
IP: Identification         = 0x0007 (7)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x605E (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0007 (7)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [4 bytes] ---
ICMP:  41 4E 56 4C                                       ANVL
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [14 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00         ..............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0xBB06 (47878)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x81DD (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000003 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 32 bytes
IP: Identification         = 0x0007 (7)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x605E (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0007 (7)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [4 bytes] ---
ICMP:  41 4E 56 4C                                       ANVL
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  81 C4 E6 81 A3 F4 27 99 60 2F EA 9B               ......'.`/..
ESP: --- Authentication Data End ---
ESP:

Correctly received Padding field in ESP Trailer:01 02                                             ..
received on interface eth3 (30.1.1.150) (Remote Host)


Case 4: send ICMP Echo Request with 3 bytes of ULP Information
Sending Non-Encrypted ICMP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 31 bytes
IP: Identification         = 0x0008 (8)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x31A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x60A9 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0008 (8)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [3 bytes] ---
ICMP:  41 4E 56                                          ANV
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [15 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00      ...............
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted  IP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 76 bytes
IP: Identification         = 0x9951 (39249)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0xA392 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000004 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 31 bytes
IP: Identification         = 0x0008 (8)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x32A9 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0x60A9 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0008 (8)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [3 bytes] ---
ICMP:  41 4E 56                                          ANV
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [3 bytes] ---
ESP:  01 02 03                                          ...
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 3 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  7E A8 BD A9 54 49 D9 3F DB 1A B8 F9               ~...TI.?....
ESP: --- Authentication Data End ---
ESP:

Correctly received Padding field in ESP Trailer:01 02 03                                          ...
received on interface eth3 (30.1.1.150) (Remote Host)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-8.6: Passed

>> IPSEC-ESP-22.1
TEST_DESCRIPTION
The security provided to a secured inbound IP packet depends on the
order in which multiple matching entries are created in SPD.
TEST_REFERENCE
RFC 4301 p20 s4.4.1 Security Policy Database
TEST_METHOD
- ANVL: Add entry in the DUT's SPD such that inbound secured
        IP-datagrams via interface D1 with outer IP Destination
        Address within Subnet-2 (specified using address + mask) are
        bypassed. Add another entry in the DUT's SPD such that
        inbound secured IP-datagrams with outer IP Destination Address
        set to A2Addr, are processed using IPSec
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward secured ICMP Echo Request, to Local Host
- ANVL: Delete all SPD entries in DUT. Add the SPD entries again, but
        in reverse order (the SPD entry for Subnet-2 which was earlier
        added first is added second this time)
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward unsecured ICMP Echo Request, to Local Host
- ANVL: Delete all SPD entries in DUT. Add entry in the DUT's SPD such
        that inbound secured IP-datagrams via interface D1, with inner
        IP-Header Destination Address within Subnet-2 (specified using
        address + mask) are processed using IPsec. Add another entry
        in the DUT's SPD such that inbound secured IP-datagrams with
        inner IP-Header Destination Address set to A2Addr,
        are bypassed
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward unsecured ICMP Echo Request, to Local Host
- ANVL: Delete all SPD entries in DUT. Add the SPD entries again just
        as last time, except that the entry for Subnet-2 is added
        second
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward secured ICMP Echo Request, to Local Host
- ANVL: Restore default SA and SPD between ANVL and DUT
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1862  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1863  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1864  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1865  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1866  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1389] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1390] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1388] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1391] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Removing ANVL Local Address (40.1.1.150) and Remote Host Address (30.1.1.150)
from IPSec SAs configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 40.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-remove-anvl-from-sa-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1867  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1867  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=use prio=0 dscp=0x0 dir=in id=1390
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1867  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=use prio=0 dscp=0x0 dir=out id=1391
------------------------------------------
Total of 4 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -flowpri 10 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1868  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1392
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1869  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1393
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1870  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1394
------------------------------------------
-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1871  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1871  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1393
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1871  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1392
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1871  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1394
------------------------------------------
Total of 5 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
BYPASS IPSec for LOCAL Host(40.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 0.0.0.255 BYPASS LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1872  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1872  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1393
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1392
------------------------------------------
Total of 3 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0  -bypass -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=1873  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1874  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1874  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1395
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1392
------------------------------------------
Total of 3 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
APPLY IPSec for LOCAL Host(40.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 APPLY LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1875  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1875  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1395
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1392
------------------------------------------
Total of 3 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -flowpri 10 -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1876  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1396
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1877  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1877  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1395
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1877  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1396
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1392
------------------------------------------
Total of 4 flows
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x000A (10)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x313D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000001 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0009 (9)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x319B (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDF1 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0009 (9)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  2B ED 8F 51 54 85 45 86 B7 7B 13 50               +..QT.E..{.P
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for Encrypted IPv4 Packet

Received encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x000A (10)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x323D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000001 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0009 (9)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x319B (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDF1 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0009 (9)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  2B ED 8F 51 54 85 45 86 B7 7B 13 50               +..QT.E..{.P
ESP: --- Authentication Data End ---
ESP:

Correctly, received secured IP packet on interface
eth4 (40.1.1.150) (Local Host)

Removing ANVL Local Address (40.1.1.150) and Remote Host Address (30.1.1.150)
from IPSec SAs configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 40.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-remove-anvl-from-sa-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1878  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1878  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1395
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1878  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1396
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1878  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1392
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1878  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1394
------------------------------------------
Total of 6 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -flowpri 10 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1879  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1397
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1880  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1398
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1881  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1399
------------------------------------------
-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1882  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1882  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1398
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1882  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1396
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1882  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1397
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1882  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1399
------------------------------------------
Total of 6 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
APPLY IPSec for LOCAL Host(40.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 APPLY LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1883  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1883  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1398
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1883  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1396
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1397
------------------------------------------
Total of 4 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -flowpri 10 -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1884  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1885  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1885  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1398
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1885  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1397
------------------------------------------
Total of 4 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
BYPASS IPSec for LOCAL Host(40.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 0.0.0.255 BYPASS LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1886  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1886  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1398
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1886  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1397
------------------------------------------
Total of 4 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0  -bypass -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=1887  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1888  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1888  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1401
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1888  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1397
------------------------------------------
Total of 4 flows
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x000C (12)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BCC (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000002 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x000B (11)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3199 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDF0 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000A (10)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  13 BD B5 C9 BE 32 24 4E 28 BF 62 3F               .....2$N(.b?
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x000B (11)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3299 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDF0 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000A (10)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received unsecured IP Packet on interface
eth4 (40.1.1.150) (Local Host)

Removing ANVL Local Address (40.1.1.150) and Remote Host Address (30.1.1.150)
from IPSec SAs configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 40.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-remove-anvl-from-sa-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1889  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1889  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1401
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1889  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1889  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1397
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1889  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1399
------------------------------------------
Total of 6 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -flowpri 10 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1890  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1402
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1891  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1403
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1892  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1404
------------------------------------------
-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1893  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1893  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1403
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1893  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1893  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1402
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1893  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1404
------------------------------------------
Total of 6 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
APPLY IPSec for LOCAL Host(40.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 0.0.0.255 APPLY LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1894  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1894  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1403
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1894  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1402
------------------------------------------
Total of 4 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1895  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1896  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1896  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=use prio=0 dscp=0x0 dir=in id=1405
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1896  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1402
------------------------------------------
Total of 4 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
BYPASS IPSec for LOCAL Host(40.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 BYPASS LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1897  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1897  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=use prio=0 dscp=0x0 dir=in id=1405
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1897  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1402
------------------------------------------
Total of 4 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -bypass -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=1898  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1899  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1899  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1406
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1899  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=use prio=0 dscp=0x0 dir=in id=1405
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1899  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1402
------------------------------------------
Total of 5 flows
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x000E (14)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BCA (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000003 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x000D (13)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3197 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEF (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000B (11)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  0A 28 04 78 2D F8 80 E3 6C 59 CA AC               .(.x-...lY..
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x000D (13)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3297 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEF (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000B (11)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly received unsecured IP packet on interface
eth4 (40.1.1.150) (Local Host)

Removing ANVL Local Address (40.1.1.150) and Remote Host Address (30.1.1.150)
from IPSec SAs configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 40.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-remove-anvl-from-sa-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1900  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1900  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1406
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1900  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=use prio=0 dscp=0x0 dir=in id=1405
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1900  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1900  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1402
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1900  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1404
------------------------------------------
Total of 7 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -flowpri 10 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1901  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1407
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1902  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1408
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1903  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1409
------------------------------------------
-> cmd keyadm dumpflow 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1904  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1904  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1406
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1904  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1408
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1904  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1904  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1407
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1904  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=128.224.166.238/32 port=500
 DSTFLOW: addr=0.0.0.0/0
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=out id=1388
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=out id=1409
------------------------------------------
Total of 7 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
BYPASS IPSec for LOCAL Host(40.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 BYPASS LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1905  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1905  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1406
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1905  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1408
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1905  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1407
------------------------------------------
Total of 5 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -bypass -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=1906  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1907  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1907  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1410
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1907  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1408
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1907  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1407
------------------------------------------
Total of 5 flows
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Inbound IPSec policy:
APPLY IPSec for LOCAL Host(40.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 0.0.0.255 APPLY LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-inbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1908  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1908  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1410
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=1908  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1408
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1908  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1407
------------------------------------------
Total of 5 flows
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1909  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dumpflow -ingress 
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1910  pid=0x5de180
PROTOCOL: proto=UDP 
 SRCFLOW: addr=0.0.0.0/0
 DSTFLOW: addr=128.224.166.238/32 port=500
 FLOWOPT: type=bypass prio=-120 dscp=0x0 dir=in id=1389
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=BYPASS  len=136  seq=1910  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=bypass prio=0 dscp=0x0 dir=in id=1410
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1910  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=use prio=0 dscp=0x0 dir=in id=1411
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=ESP  len=136  seq=1910  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=use prio=10 dscp=0x0 dir=in id=1400
------------------------------------------
SADB_MSG: msgtype=X_DUMPFLOW  err=0  satype=NONE  len=136  seq=0  pid=0x5de180
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
 FLOWOPT: type=deny prio=10 dscp=0x0 dir=in id=1407
------------------------------------------
Total of 5 flows
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0010 (16)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3137 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000004 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x000F (15)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3195 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEE (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000C (12)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  F1 CB 39 E1 D4 0E E1 44 18 7E E8 F6               ..9....D.~..
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for Encrypted IPv4 Packet

Received encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0010 (16)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3237 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000004 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x000F (15)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3195 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEE (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000C (12)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  F1 CB 39 E1 D4 0E E1 44 18 7E E8 F6               ..9....D.~..
ESP: --- Authentication Data End ---
ESP:

Correctly received Secured IP packet on interface
eth4 (40.1.1.150) (Local Host)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-22.1: Passed

>> IPSEC-ESP-23.1
TEST_DESCRIPTION
IPSec MUST allow administrative interface to edit SPD and specify
method of processing inbound traffic based on a Destination Address
selector.
TEST_REFERENCE
RFC 4301 s4.4.1 p21(SPD-O) The Security Policy Database
TEST_METHOD
- ANVL: Add entry in the DUT's SPD such that inbound secured
        IP-datagrams with outer IP Destination Address set to
        ANVL Local Address are Discarded
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Do not forward ICMP Echo Request, to Local Host
- ANVL: Modify the SPD entry to use Bypass
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward secured ICMP Echo Request, to Local Host
- ANVL: Modify the SPD entry to use IPsec
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward ICMP Echo Request, to Local Host
- ANVL: Restore default SA and SPD between ANVL and DUT
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1911  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1912  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1913  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1914  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1915  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1413] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1414] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1412] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1415] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec for LOCAL Host(40.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 DISCARD LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1916  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1917  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1416
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1918  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30370 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30370 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0012 (18)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BC6 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000005 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0011 (17)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3193 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDED (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000D (13)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  2A 66 1A 42 3D EF 55 02 F7 14 7F E3               *f.B=.U.....
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Correctly, no IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec for LOCAL Host(40.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 BYPASS LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1919  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=1920  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1921  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30370 usetime=30370 bytes=56
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30370 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0014 (20)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3133 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000006 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0013 (19)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3191 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEC (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000E (14)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  90 5D 6A 9E 81 0A B6 5B AD 98 FA 2D               .]j....[...-
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for Encrypted IPv4 Packet

Received encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0014 (20)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3233 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000006 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0013 (19)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3191 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEC (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000E (14)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  90 5D 6A 9E 81 0A B6 5B AD 98 FA 2D               .]j....[...-
ESP: --- Authentication Data End ---
ESP:

Correctly Received Encrypted IP Packet on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec for LOCAL Host(40.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 APPLY LOCAL

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1922  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1923  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1924  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30370 usetime=30370 bytes=56
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30370 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0016 (22)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BC2 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000007 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0015 (21)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x318F (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEB (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000F (15)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  69 AA 7C F0 0E C9 56 31 FA E3 BD EE               i.|...V1....
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0015 (21)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x328F (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEB (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x000F (15)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150) (Local Host)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-23.1: Passed

>> IPSEC-ESP-23.2
TEST_DESCRIPTION
IPSec MUST allow administrative interface to edit SPD and specify
method of processing inbound traffic based on a Source Address
selector.
TEST_REFERENCE
RFC 4301 s4.4.1 p21(SPD-O) The Security Policy Database
TEST_METHOD
- ANVL: Add entry in the DUT's SPD such that inbound IP-datagrams from
        ANVL to DUT with outer IP Source Address virtual Host IP
        address ANVL Remote Address, are Discarded
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Do not forward ICMP Echo Request, to Local Host
- ANVL: Modify the SPD entry to use Bypass
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward secured ICMP Echo Request, to Local Host
- ANVL: Modify the SPD entry to use IPsec
- ANVL: Send secured ICMP Echo Request, from Remote Host
-  DUT: Forward ICMP Echo Request, to Local Host
- ANVL: Restore default SA and SPD between ANVL and DUT
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1925  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1926  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1927  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1928  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1929  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1420] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1421] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1419] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1422] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec for REMOTE Host(30.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 DISCARD REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1930  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=192  seq=1931  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1423
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1932  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30381 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30381 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0018 (24)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BC0 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000008 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0017 (23)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x318D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDEA (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0010 (16)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  AC 05 70 8F 8E 83 51 E6 8D AC 30 3A               ..p...Q...0:
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Correctly, No IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec for REMOTE Host(30.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 BYPASS REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1933  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=1934  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1935  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30381 usetime=30381 bytes=56
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30381 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x001A (26)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x312D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000009 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0019 (25)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x318B (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE9 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0011 (17)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  9F C2 D2 B0 D7 A6 6D 9A 7A 3E C9 62               ......m.z>.b
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for Encrypted IPv4 Packet

Received encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x001A (26)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x322D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000009 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0019 (25)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x318B (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE9 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0011 (17)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  9F C2 D2 B0 D7 A6 6D 9A 7A 3E C9 62               ......m.z>.b
ESP: --- Authentication Data End ---
ESP:

Correctly Received Encrypted IP Packet on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec for REMOTE Host(30.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 APPLY REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-host-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1936  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1937  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.150/32
 DSTFLOW: addr=40.1.1.150/32
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1938  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30381 usetime=30381 bytes=56
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30381 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x001C (28)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BBC (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x0000000A 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x001B (27)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3189 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE8 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0012 (18)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  75 BB CB FB 13 BD 1A 22 2F 2E C7 82               u......"/...
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x001B (27)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3289 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE8 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0012 (18)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received Unsecure IP Packet on interface
eth4 (40.1.1.150) (Local Host)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-23.2: Passed

>> IPSEC-ESP-23.3
TEST_DESCRIPTION
IPSec MUST allow administrative interface to edit SPD and specify
method of processing inbound traffic based on a Transport Layer
Protocol selector.
TEST_REFERENCE
RFC 4301 s4.4.1 p21(SPD-O) The Security Policy Database
TEST_METHOD
- ANVL: Add entry in the DUT's SPD such that inbound IP-datagrams from
        ANVL to DUT with Transport Protocol set to <protocol>, are
        Discarded
- ANVL: Send Unsecured IP Packet with Transport Layer Protocol
        <protocol>, from Remote Host
-  DUT: Do not forward the IP packet, to Local Host
- ANVL: Modify the SPD entry to use Bypass
- ANVL: Send unsecured IP Packet with Transport Layer Protocol
        <protocol>, from Remote Host
-  DUT: Forward the unsecured IP packet, to Local Host
- ANVL: Modify the SPD entry to use IPsec
- ANVL: Send secured IP Packet with Transport Layer Protocol
        <protocol>, from Remote Host
-  DUT: Forward the IP packet, to Local Host
- ANVL: Restore default SA and SPD between ANVL and DUT
- CASE: <protocol> = ICMP
- CASE: <protocol> = TCP
- CASE: <protocol> = UDP
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1939  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1940  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1941  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1942  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1943  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1427] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1428] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1426] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1429] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


<CASE> :: <Protocol> = ICMP

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec to the IP packet for icmp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
icmp DISCARD

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1944  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 0 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=200  seq=1945  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1430
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1946  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30392 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30392 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted ICMP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x001D (29)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3187 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE7 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0013 (19)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for ICMP Packet
Correctly, No IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec to the IP packet for icmp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
icmp BYPASS

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1947  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 0 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=184  seq=1948  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1949  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30392 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30392 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted ICMP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x001E (30)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3186 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE6 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0014 (20)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for ICMP Packet
Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x001E (30)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3286 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE6 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0014 (20)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly received unsecured IP Packet on interface
eth3 (40.1.1.150)(Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec to the IP packet for icmp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
icmp APPLY

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1950  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 0 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=184  seq=1951  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=any
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1952  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30392 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30392 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted ICMP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x0020 (32)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BB8 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x0000000B 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x001F (31)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3185 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE5 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0015 (21)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  15 B5 B7 CA 29 EE 63 3C 0E 72 81 6D               ....).c<.r.m
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x001F (31)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3285 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE5 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0015 (21)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150)(Local Host)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1953  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1954  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1955  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1956  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1957  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1434] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1435] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1433] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1436] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


<CASE> :: <Protocol> = TCP

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec to the IP packet for tcp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp DISCARD

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1958  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=200  seq=1959  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1437
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1960  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30403 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30403 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted TCP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0021 (33)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3182 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xECB0 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for TCP Packet
Correctly, No IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec to the IP packet for tcp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp BYPASS

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1961  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=184  seq=1962  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1963  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30403 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30403 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted TCP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0022 (34)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3181 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xECB0 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for TCP Packet
Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0022 (34)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3281 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xECB0 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Correctly received unsecured IP Packet on interface
eth3 (40.1.1.150)(Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec to the IP packet for tcp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp APPLY

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1964  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=184  seq=1965  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1966  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30403 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30403 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted TCP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 84 bytes
IP: Identification         = 0x0024 (36)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BB8 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x0000000C 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0023 (35)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3180 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xECB0 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  7E 7E 37 8B 3C 08 C0 9D 3A 30 12 CA               ~~7.<...:0..
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0023 (35)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3280 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xECB0 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150)(Local Host)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1967  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1968  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1969  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1970  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1971  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1441] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1442] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1440] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1443] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


<CASE> :: <Protocol> = UDP

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec to the IP packet for udp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp DISCARD

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1972  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=200  seq=1973  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1444
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1974  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30413 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30413 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted UDP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0025 (37)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x317F (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for UDP Packet

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:15:17:C8:90:29
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly, No IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec to the IP packet for udp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp BYPASS

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1975  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=184  seq=1976  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1977  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30413 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30413 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted UDP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0026 (38)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x317E (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for UDP Packet
Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0026 (38)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x327E (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly received unsecured IP Packet on interface
eth3 (40.1.1.150)(Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec to the IP packet for udp transport protocol
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp APPLY

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1978  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=184  seq=1979  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1980  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30413 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30413 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted UDP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 72 bytes
IP: Identification         = 0x0028 (40)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BC0 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x0000000D 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0027 (39)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x317D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  DA CA A0 1C 54 19 D9 29 E4 99 80 08               ....T..)....
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0027 (39)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x327D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150)(Local Host)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1981  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1982  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1983  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1984  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1985  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1448] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1449] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1447] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1450] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-23.3: Passed

>> IPSEC-ESP-23.4
TEST_DESCRIPTION
IPSec MUST allow administrative interface to edit SPD and specify
method of processing inbound traffic based on TCP/UDP Source Port
selector.
TEST_REFERENCE
RFC 4301 s4.4.1.1 p27 Selectors
TEST_METHOD
- ANVL: Add entry in the DUT's SPD such that inbound IP-datagrams from
        ANVL to DUT with Transport Protocol set to <protocol> and
        Transport Protocol Source Port Number set to <port>, are
        Discarded
- ANVL: Send Unsecured IP Packet with Transport Layer Protocol
        <protocol> and Transport Protocol Source Port Number set to
        <port>, from Remote Host
-  DUT: Do not forward the IP packet, to Local Host
- ANVL: Modify the SPD entry to use Bypass
- ANVL: Send Unsecured IP Packet with Transport Layer Protocol
        <protocol> and Transport Protocol Source Port Number set
        to <port>, from Remote Host
-  DUT: Forward the Unsecured IP packet, to Local Host
- ANVL: Modify the SPD entry to use IPsec
- ANVL: Send secured IP Packet with Transport Layer Protocol
        <protocol> and Transport Protocol Source Port Number set to
        <port>, from Remote Host
-  DUT: Forward the IP packet, to Local Host
- ANVL: Restore default SA and SPD between ANVL and DUT
- CASE: <protocol> = TCP, <port> = 6000
- CASE: <protocol> = UDP, <port> = 6000
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=1986  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1987  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1988  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=1989  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=1990  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1452] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1453] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1451] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1454] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


<CASE> :: <Protocol> = TCP, <Source Port> = 6000

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec to the IP packet for tcp transport protocol and SOURCE port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp SOURCE 6000 DISCARD

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=1991  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -srcport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=200  seq=1992  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24 port=6000
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1455
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1993  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30425 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30425 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted TCP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0029 (41)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x317A (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 6000 (6000)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xFC51 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for TCP Packet
Correctly, no IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec to the IP packet for tcp transport protocol and SOURCE port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp SOURCE 6000 BYPASS

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1994  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -srcport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=184  seq=1995  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24 port=6000
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1996  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30425 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30425 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted TCP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x002A (42)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3179 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 6000 (6000)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xFC51 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for TCP Packet
Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x002A (42)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3279 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 6000 (6000)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xFC51 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Correctly Received UnSecured IP Packet on interface
eth3 (40.1.1.150)(Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec to the IP packet for tcp transport protocol and SOURCE port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp SOURCE 6000 APPLY

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=1997  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -srcport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=184  seq=1998  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24 port=6000
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=1999  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30425 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30425 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted TCP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 84 bytes
IP: Identification         = 0x002C (44)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BB0 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x0000000E 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x002B (43)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3178 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 6000 (6000)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xFC51 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  0C 14 07 82 6E AB 8D 7D D1 34 18 AA               ....n..}.4..
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x002B (43)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3278 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 6000 (6000)
TCP: Destination Port      = 20001 (20001)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0xFC51 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150) (Local Host)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=2000  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2001  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2002  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2003  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2004  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1459] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1460] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1458] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1461] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


<CASE> :: <Protocol> = UDP, <Source Port> = 6000

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec to the IP packet for udp transport protocol and SOURCE port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp SOURCE 6000 DISCARD

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2005  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -srcport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=200  seq=2006  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24 port=6000
 DSTFLOW: addr=40.1.1.150/24
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1462
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2007  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30436 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30436 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted UDP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x002D (45)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x3177 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 6000 (6000)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for UDP Packet
Correctly, no IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec to the IP packet for udp transport protocol and SOURCE port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp SOURCE 6000 BYPASS

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2008  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -srcport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=184  seq=2009  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24 port=6000
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2010  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30436 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30436 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted UDP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x002E (46)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x3176 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 6000 (6000)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for UDP Packet
Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x002E (46)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x3276 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 6000 (6000)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received UnSecured IP Packet on interface
eth3 (40.1.1.150)(Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec to the IP packet for udp transport protocol and SOURCE port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp SOURCE 6000 APPLY

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2011  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -srcport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=184  seq=2012  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24 port=6000
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2013  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30436 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30436 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted UDP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 72 bytes
IP: Identification         = 0x0030 (48)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BB8 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x0000000F 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x002F (47)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x3175 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 6000 (6000)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  2D 21 8A 28 84 75 05 D8 D2 6B 77 1A               -!.(.u...kw.
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x002F (47)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x3275 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 6000 (6000)
UDP: Destination Port = 0 (0)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150) (Local Host)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=2014  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2015  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2016  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2017  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2018  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1466] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1467] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1465] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1468] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-23.4: Passed

>> IPSEC-ESP-23.5
TEST_DESCRIPTION
IPSec MUST allow administrative interface to edit SPD and specify
method of processing inbound traffic based on TCP/UDP Destination
Port selector.
TEST_REFERENCE
RFC 4301 s4.4.1.1 p27 Selectors
TEST_METHOD
- ANVL: Add entry in the DUT's SPD such that inbound IP-datagrams from
        ANVL to DUT with Transport Protocol set to <protocol> and
        Transport Protocol Destination Port Number set to <port>, are
        Discarded
- ANVL: Send unsecured IP Packet with Transport Layer Protocol
        <protocol> and Transport Protocol Destination Port Number
        set to <port>, from Remote Host
-  DUT: Do not forward the IP packet, to Local Host
- ANVL: Modify the SPD entry to use Bypass
- ANVL: Send unsecured IP Packet with Transport Layer Protocol
        <protocol> and Transport Protocol Destination Port Number
        set to <port>, from Remote Host
-  DUT: Forward the unsecured IP packet, to Local Host
- ANVL: Modify the SPD entry to use IPsec
- ANVL: Send secured IP Packet with Transport Layer Protocol
        <protocol> and Transport Protocol Destination Port Number
        set to <port>, from Remote Host
-  DUT: Forward the IP packet, to Local Host
- ANVL: Restore default SA and SPD between ANVL and DUT
- CASE: <protocol> = TCP, <port> = 6000
- CASE: <protocol> = UDP, <port> = 6000
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=2019  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2020  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2021  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2022  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2023  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1470] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1471] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1469] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1472] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


<CASE> :: <Protocol> = TCP, <Destination Port> = 6000

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec to the IP packet for tcp transport protocol and DESTINATION port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp DESTINATION 6000 DISCARD

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2024  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -dstport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=200  seq=2025  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24 port=6000
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1473
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2026  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30447 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30447 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted TCP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0031 (49)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3172 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 6000 (6000)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0x2362 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for TCP Packet
Correctly, no IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec to the IP packet for tcp transport protocol and DESTINATION port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp DESTINATION 6000 BYPASS

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2027  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -dstport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=184  seq=2028  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24 port=6000
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2029  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30447 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30447 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted TCP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0032 (50)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3171 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 6000 (6000)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0x2362 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for TCP Packet
Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0032 (50)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3271 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 6000 (6000)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0x2362 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Correctly Received UnSecured IP Packet on interface
eth3 (40.1.1.150)(Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec to the IP packet for tcp transport protocol and DESTINATION port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
tcp DESTINATION 6000 APPLY

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2030  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 6 -dstport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=184  seq=2031  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=TCP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24 port=6000
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2032  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30447 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30447 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted TCP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 84 bytes
IP: Identification         = 0x0034 (52)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BA8 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000010 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0033 (51)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3170 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 6000 (6000)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0x2362 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  45 2C 28 EC BF E0 12 7A CB 3E C3 D9               E,(....z.>..
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 40 bytes
IP: Identification         = 0x0033 (51)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = TCP (6)
IP: Header Checksum        = 0x3270 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
TCP: ---- TCP Packet ----
TCP:
TCP: Source Port           = 10001 (10001)
TCP: Destination Port      = 6000 (6000)
TCP: Sequence Number       = 1234 (0x000004D2)
TCP: Acknowledgment Number = 0 (0x00000000) (Not Significant)
TCP: Data Offset           = 5 (20 bytes)
TCP: Reserved              = 0 
TCP: Control Bits          = 0x02
TCP:  |543210
TCP:  |0.....              = Urgent Pointer Isn't Significant
TCP:  |.0....              = Acknowledgment Isn't Significant
TCP:  |..0...              = No Push Function
TCP:  |...0..              = No Reset Connection
TCP:  |....1.              = Synchronize Sequence Numbers
TCP:  |.....0              = More Data From Sender
TCP: Window                = 0 bytes
TCP: Checksum              = 0x2362 (Correct)
TCP: Urgent Pointer        = 0 (Not Significant)
TCP:
ETHER: --- Padding [6 bytes] ---
ETHER:  00 00 00 00 00 00                                 ......
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150)(Local Host)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=2033  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2034  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2035  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2036  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2037  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1477] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1478] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1476] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1479] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.


<CASE> :: <Protocol> = UDP, <Destination Port> = 6000

Configuring DUT with the following Inbound IPSec policy:
DISCARD IPSec to the IP packet for udp transport protocol and DESTINATION port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp DESTINATION 6000 DISCARD

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2038  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -dstport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -deny -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=200  seq=2039  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24 port=6000
 FLOWOPT: type=deny prio=0 dscp=0x0 dir=in id=1480
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2040  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30458 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30458 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted UDP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0035 (53)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x316F (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 6000 (6000)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for UDP Packet
Correctly, no IP packets received on interface
eth4 (40.1.1.150) (Local Host)

Configuring DUT with the following Inbound IPSec policy:
BYPASS IPSec to the IP packet for udp transport protocol and DESTINATION port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp DESTINATION 6000 BYPASS

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2041  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -dstport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=184  seq=2042  pid=0x5de180
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24 port=6000
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2043  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30458 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30458 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted UDP IP packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0036 (54)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x316E (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 6000 (6000)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for UDP Packet
Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0036 (54)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x326E (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 6000 (6000)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received UnSecured IP Packet on interface
eth3 (40.1.1.150)(Local Host)

Configuring DUT with the following Inbound IPSec policy:
APPLY IPSec to the IP packet for udp transport protocol and DESTINATION port 6000
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
udp DESTINATION 6000 APPLY

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-set-inbound-spd-for-protocol-and-port-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm delflow -proto esp -spi 300 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2044  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -transport 17 -dstport 6000 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.150 -dstflow 40.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=184  seq=2045  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
PROTOCOL: proto=UDP 
 SRCFLOW: addr=30.1.1.150/24
 DSTFLOW: addr=40.1.1.150/24 port=6000
------------------------------------------
-> cmd keyadm dump
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=2046  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 AUTHKEY: bits=128
 CURRENT: addtime=30458 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
SADB_MSG: msgtype=DUMP  err=0  satype=ESP  len=152  seq=0  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 AUTHKEY: bits=128
 CURRENT: addtime=30458 usetime=0 bytes=0
     SA2: mode=tunnel reqid=0
------------------------------------------
Total of 2 security associations
-> exit
Au revoir!
Connection closed by foreign host.
Sending encrypted UDP (over IPv4) packet from interface eth3 (ANVL virtual address 30.1.1.150) 
to interface eth4 (ANVL virtual address 40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 72 bytes
IP: Identification         = 0x0038 (56)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3BB0 (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 30.1.1.5
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000300 
ESP: Sequence Number          = 0x00000011 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0037 (55)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x316D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 6000 (6000)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  E2 6A 9E D6 C1 82 4E AE FB C7 1E FE               .j....N.....
ESP: --- Authentication Data End ---
ESP:

Waiting (up to 10.000 seconds) for IPv4 Packet

Received non-encrypted IP packet from 30.1.1.150 on interface eth4 (40.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 28 bytes
IP: Identification         = 0x0037 (55)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = UDP (17)
IP: Header Checksum        = 0x326D (Correct)
IP: Source Address         = 30.1.1.150
IP: Destination Address    = 40.1.1.150
IP:
UDP: ---- UDP Packet ----
UDP:
UDP: Source Port      = 0 (0)
UDP: Destination Port = 6000 (6000)
UDP: Length           = 8 
UDP: Checksum         = 0x0000 
UDP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received Unsecured IP Packet on interface
eth4 (40.1.1.150)(Local Host)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=2047  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2048  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2049  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2050  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2051  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1484] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1485] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1483] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1486] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-23.5: Passed

>> IPSEC-ESP-26.7
TEST_DESCRIPTION
The security provided to an outbound IP packet depends on the order in
which multiple matching entries are created in SPD
TEST_REFERENCE
RFC 4301 s4.4.1 p20 Security Policy Database
TEST_METHOD
- ANVL: Add entry in the DUT's SPD such that outbound IP-datagrams
        via interface D1 with IP Destination Address within Subnet-x
        (specified using address + mask) are bypassed. Add another
        entry in the DUT's SPD such that outbound IP-datagrams with
        inner IP Destination Address set to ANVL Remote Address are
        processed using IPSec
- ANVL: Send ICMP Echo Request down interface A2 destined to virtual
        host address ANVL Remote Address
-  DUT: Forward unsecured ICMP Echo Request down interface A1
- ANVL: Delete all SPD entries in DUT. Add the SPD entries again but
        in reverse order (the SPD entry for Subnet-x which was earlier
        added first is added second this time)
- ANVL: Send ICMP Echo Request down interface A2 destined to virtual
        host address ANVL Remote Address
-  DUT: Forward secured ICMP Echo Request down interface A1
- ANVL: Delete all SPD entries in DUT. Add entry in the DUT's SPD such
        that outbound IP-datagrams via interface D1 with inner
        IP-Header Destination Address within Subnet-x (specified using
        address + mask) are processed using IPsec. Add another entry
        in the DUT's SPD such that outbound IP-datagrams with
        inner IP-Header Destination Address set to ANVL Remote
        Address are bypassed
- ANVL: Send ICMP Echo Request down interface A2 destined to virtual
        host address ANVL Remote Address
-  DUT: Forward secured ICMP Echo Request down interface A1
- ANVL: Delete all SPD entries in DUT. Add the SPD entries again just
        as last time except that the entry for Subnet-x is added
        second
- ANVL: Send ICMP Echo Request down interface A2 destined to virtual
        host address ANVL Remote Address
-  DUT: Forward unsecured ICMP Echo Request, down interface A1
- ANVL: Restore default SA and SPD between ANVL and DUT
TEST_CLASSIFICATION
MUST
TEST_TOPOLOGY
TOPOLOGY-1

ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
0 30.1.1.5 40.1.1.5 255.255.255.0 255.255.255.0 40.1.1.150 30.1.1.150 TUNNEL MANUAL PRESHARED-KEY HMAC_MD5 HMAC_MD5_96 ESP_DES NULL NOT_CONFIGURED 66306630663066306630663066302222  768 770 NOT_CONFIGURED SHA DES_CBC MODP768 MODP1024

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-esp-reset-ip-security-command-noencry.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
aaa=24
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=2052  pid=0x5de180
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -akey 66306630663066306630663066302222 -ingress -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2053  pid=0x5de180
      SA: spi=300  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 300 -src 30.1.1.150 -dst 30.1.1.5 -srcflow 30.1.1.0 -dstflow 40.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -ingress
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2054  pid=0x5de180
      SA: spi=300  sta=LARVAL  auth=NONE  enc=NONE  replay=0  ingress 
     SRC: addr=30.1.1.150
     DST: addr=30.1.1.5
 SRCFLOW: addr=30.1.1.0/24
 DSTFLOW: addr=40.1.1.0/24
------------------------------------------
-> cmd keyadm add -proto esp -enc none -auth md5 -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -akey 66306630663066306630663066302222 -forcetunnel -replay 32
SADB_MSG: msgtype=ADD  err=0  satype=ESP  len=80  seq=2055  pid=0x5de180
      SA: spi=302  sta=MATURE  auth=MD5  enc=NONE  replay=32  tunnel 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
------------------------------------------
-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.0 -dstflow 30.1.1.0 -srcmask 255.255.255.0 -dstmask 255.255.255.0
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2056  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.0/24
 DSTFLOW: addr=30.1.1.0/24
------------------------------------------
-> cmd ipsecctrl sa
SA - Security Associations:
[ 1] :: ESP  spi=0x300   src=30.1.1.150        dst=30.1.1.5          auth=md5 hmac enc=none
[ 2] :: ESP  spi=0x302   src=30.1.1.5          dst=30.1.1.150        auth=md5 hmac enc=none
Total of 2 SAs.
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1490] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Clearing the SPD entry based on Source Address (40.1.1.150) and 
Destination Address (30.1.1.150)
configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 30.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-anvl-clear-spd-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd ipsecctrl flows 
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1490] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2057  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2058  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd ipsecctrl flows 
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
exit
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
Total of 3 flows.
-> 
Configuring DUT by adding the following Outbound IPSec policy:
BYPASS IPSec for REMOTE Host(30.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 0.0.0.255 BYPASS REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow  30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -bypass -replace 
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=2059  pid=0x5b38d0
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1491] :: bypass src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: BYPS
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Outbound IPSec Policy:
APPLY IPSec for REMOTE Host(30.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 APPLY REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-host-command-26-7special.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2060  pid=0x5b38d0
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/32
 DSTFLOW: addr=30.1.1.150/32
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1492] :: use src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
[1491] :: bypass src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: BYPS
Total of 5 flows.
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted ICMP IP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0039 (57)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x316B (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE4 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0016 (22)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for ICMP Packet

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0xFE1A (65050)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x3EBD (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000001 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x0039 (57)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x326B (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE4 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0016 (22)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  29 53 47 02 CD 01 57 29 F7 A6 C2 62               )SG...W)...b
ESP: --- Authentication Data End ---
ESP:


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:15:17:C8:90:28
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly received Unsecured IP packets on interface
eth3 (30.1.1.150) (Remote Host)

Clearing the SPD entry based on Source Address (40.1.1.150) and 
Destination Address (30.1.1.150)
configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 30.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-anvl-clear-spd-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd ipsecctrl flows 
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1492] :: use src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
[1491] :: bypass src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: BYPS
Total of 5 flows.
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2061  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2062  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
 SRCFLOW: addr=40.1.1.150/32
 DSTFLOW: addr=30.1.1.150/32
------------------------------------------
-> cmd ipsecctrl flows 
Flows:
exit
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
Total of 3 flows.
-> 
Configuring DUT by adding the following Outbound IPSec Policy:
APPLY IPSec for REMOTE Host(30.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 APPLY REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-host-command-26-7special.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2063  pid=0x5b38d0
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/32
 DSTFLOW: addr=30.1.1.150/32
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1493] :: use src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Outbound IPSec policy:
BYPASS IPSec for REMOTE Host(30.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 0.0.0.255 BYPASS REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow  30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -bypass -replace 
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=176  seq=2064  pid=0x5b38d0
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1493] :: use src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
[1494] :: bypass src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: BYPS
Total of 5 flows.
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted ICMP IP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x003A (58)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x316A (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE3 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0017 (23)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted ICMP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0xBFD5 (49109)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0x7D02 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000002 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x003A (58)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x326A (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE3 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0017 (23)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  8D 2E 7E ED C9 20 72 9F F7 39 A1 4F               ..~.. r..9.O
ESP: --- Authentication Data End ---
ESP:

Correctly Received Secured IP Packet on interface
eth3 (30.1.1.150) (Remote Host)

Clearing the SPD entry based on Source Address (40.1.1.150) and 
Destination Address (30.1.1.150)
configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 30.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-anvl-clear-spd-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd ipsecctrl flows 
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1493] :: use src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
[1494] :: bypass src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: BYPS
Total of 5 flows.
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2065  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2066  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
 SRCFLOW: addr=40.1.1.150/32
 DSTFLOW: addr=30.1.1.150/32
------------------------------------------
-> cmd ipsecctrl flows 
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
exit
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
Total of 3 flows.
-> 
Configuring DUT by adding the following Outbound IPSec policy:
APPLY IPSec for REMOTE Host(30.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 0.0.0.255 APPLY REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow  30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -replace 
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2067  pid=0x5b38d0
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1495] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Outbound IPSec Policy:
BYPASS IPSec for REMOTE Host(30.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 BYPASS REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-host-command-26-7special.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -flowpri 10 -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=192  seq=2068  pid=0x5b38d0
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/32
 DSTFLOW: addr=30.1.1.150/32
 FLOWOPT: type=bypass prio=10 dscp=0x0 dir=out id=1496
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1495] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
[1496] :: bypass pri=10 src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: BYPS
Total of 5 flows.
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted ICMP IP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x003B (59)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3169 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE2 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0018 (24)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for Encrypted ICMP Packet
Received encrypted IP packet from 30.1.1.5 on interface eth3 (30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x89E7 (35303)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0xB2F0 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000003 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x003B (59)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3269 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE2 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0018 (24)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  58 90 44 9F EC 2E 31 A8 7E 1C A1 1C               X.D...1.~...
ESP: --- Authentication Data End ---
ESP:

Correctly Received Secured IP Packet on interface
eth3 (30.1.1.150) (Remote Host)

Clearing the SPD entry based on Source Address (40.1.1.150) and 
Destination Address (30.1.1.150)
configured on the DUT
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
40.1.1.150 30.1.1.150

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-anvl-clear-spd-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd ipsecctrl flows 
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1495] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
[1496] :: bypass pri=10 src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: BYPS
Total of 5 flows.
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 
SADB_MSG: msgtype=X_DELFLOW  err=0  satype=ESP  len=128  seq=2069  pid=0x5de180
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd keyadm delflow -proto esp -spi 302 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 
SADB_MSG: msgtype=X_DELFLOW  err=3  satype=ESP  len=16  seq=2070  pid=0x5de180
   ERRNO: errno = 0x3 (3)
------------------------------------------
-> cmd ipsecctrl flows 
Flows:
exit
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1496] :: bypass pri=10 src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: BYPS
Total of 4 flows.
-> 
Configuring DUT by adding the following Outbound IPSec Policy:
BYPASS IPSec for REMOTE Host(30.1.1.150)
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 BYPASS REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-host-command-26-7special.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow 30.1.1.150 -srcmask 255.255.255.255 -dstmask 255.255.255.255 -flowpri 10 -bypass -replace
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=BYPASS  len=192  seq=2071  pid=0x5b38d0
      SA: spi=0  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/32
 DSTFLOW: addr=30.1.1.150/32
 FLOWOPT: type=bypass prio=10 dscp=0x0 dir=out id=1497
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1497] :: bypass pri=10 src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: BYPS
Total of 4 flows.
-> exit
Au revoir!
Connection closed by foreign host.

Configuring DUT by adding the following Outbound IPSec policy:
APPLY IPSec for REMOTE Host(30.1.1.150) with mask 255.255.255.0
ANVL_DUTHOSTNAME:
128.224.166.238

ANVL_PARAMARG:
30.1.1.150 0.0.0.255 APPLY REMOTE

SCRIPT_MODE:
FOREGROUND

Executing system command:
  "./DocScriptQ35/IPSEC-ESP/ipsec-add-outbound-spd-policy-for-subnet-command.exp $ANVL_DUTHOSTNAME $ANVL_PARAMARG"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd keyadm addflow -proto esp -spi 302 -src 30.1.1.5 -dst 30.1.1.150 -srcflow 40.1.1.150 -dstflow  30.1.1.150 -srcmask 255.255.255.0 -dstmask 255.255.255.0 -replace 
SADB_MSG: msgtype=X_ADDFLOW  err=0  satype=ESP  len=176  seq=2072  pid=0x5b38d0
      SA: spi=302  sta=LARVAL  auth=NONE  enc=NONE  replay=0  replaceflow 
     SRC: addr=30.1.1.5
     DST: addr=30.1.1.150
 SRCFLOW: addr=40.1.1.150/24
 DSTFLOW: addr=30.1.1.150/24
------------------------------------------
-> cmd ipsecctrl flows
Flows:
[1488] :: bypass pri=-120 src=0.0.0.0/0:any dst=128.224.166.238/32:500 UDP  <- SA: BYPS
[1489] :: use src=30.1.1.0/24:any dst=40.1.1.0/24:any any <- SA: ESP  spi=0x300 src=30.1.1.150 dst=30.1.1.5
[1487] :: bypass pri=-120 src=128.224.166.238/32:500 dst=0.0.0.0/0:any UDP  -> SA: BYPS
[1498] :: use src=40.1.1.0/24:any dst=30.1.1.0/24:any any -> SA: ESP  spi=0x302 src=30.1.1.5 dst=30.1.1.150
[1497] :: bypass pri=10 src=40.1.1.150/32:any dst=30.1.1.150/32:any any -> SA: BYPS
Total of 5 flows.
-> exit
Au revoir!
Connection closed by foreign host.
Sending non-encrypted ICMP IP packet from interface eth4 (ANVL virtual address 40.1.1.150) 
to interface eth3 (ANVL virtual address 30.1.1.150)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:29
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x003C (60)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 64
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3168 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE1 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0019 (25)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ETHER: --- Padding [2 bytes] ---
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Waiting (up to 10.000 seconds) for ICMP Packet

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0800 (DOD IP)
ETHER:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 88 bytes
IP: Identification         = 0x90D1 (37073)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ESP (50)
IP: Header Checksum        = 0xAC06 (Correct)
IP: Source Address         = 30.1.1.5
IP: Destination Address    = 30.1.1.150
IP:
ESP: ---- ESP Header ----
ESP:
ESP: Security Parameter Index = 0x00000302 
ESP: Sequence Number          = 0x00000004 
ESP:
IP: ---- IP Packet ----
IP:
IP: Version                = 4
IP: Internet Header Length = 5 (20 bytes)
IP: Type Of Service        = 0x00
IP:  |01234567
IP:  |000.....             = Precedence (Routine)
IP:  |...0....             = Normal Delay
IP:  |....0...             = Normal Throughput
IP:  |.....0..             = Normal Reliability
IP:  |......0.             = Normal Monetary Cost
IP:  |.......0             = Must Be Zero 
IP: Total Length           = 44 bytes
IP: Identification         = 0x003C (60)
IP: Flags                  = 0
IP:  |012
IP:  |0..                  = Reserved 
IP:  |.0.                  = May Fragment
IP:  |..0                  = Last Fragment
IP: Fragment Offset        = 0x0000 (0 bytes)
IP: Time to Live           = 63
IP: Protocol               = ICMP (1)
IP: Header Checksum        = 0x3268 (Correct)
IP: Source Address         = 40.1.1.150
IP: Destination Address    = 30.1.1.150
IP:
ICMP: ---- ICMP Packet ----
ICMP:
ICMP: Type             = 8 (Echo Request)
ICMP: Code             = 0 (0)
ICMP: Checksum         = 0xEDE1 (Correct)
ICMP:
ICMP: ---- ICMP Echo Data ----
ICMP:
ICMP: Identifier       = 0x0019 (25)
ICMP: Sequence Number  = 0x0000 (0)
ICMP:
ICMP: --- Data [16 bytes] ---
ICMP:  41 4E 56 4C 20 54 45 53 54 20 44 41 54 41 20 20   ANVL TEST DATA  
ICMP: --- Data End ---
ICMP:
ICMP: ---- End of ICMP Packet ----
ESP: ---- ESP Trailer ----
ESP:
ESP: --- Padding [2 bytes] ---
ESP:  01 02                                             ..
ESP: --- Padding End ---
ESP:
ESP: Pad Length               = 2 
ESP: Next Header              = 4 
ESP:
ESP: --- Authentication Data [12 bytes] ---
ESP:  56 B4 EE 25 A0 36 86 59 75 A0 C0 AA               V..%.6.Yu...
ESP: --- Authentication Data End ---
ESP:


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:15:17:C8:90:28
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:15:17:C8:90:28
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

Correctly Received unsecured IP Packet on interface
eth3 (30.1.1.150)(Remote Host)

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BA
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BA
ARP: Source Protocol Address      = 30.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 30.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BA
ETHER: Source      = 00:15:17:C8:90:28
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:28
ARP: Source Protocol Address      = 30.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BA
ARP: Destination Protocol Address = 30.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:28

ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = FF:FF:FF:FF:FF:FF
ETHER: Source      = 00:1B:21:7D:57:BB
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Request (0x0001)
ARP: Source Hardware Address      = 00:1B:21:7D:57:BB
ARP: Source Protocol Address      = 40.1.1.150
ARP: Destination Hardware Address = 00:00:00:00:00:00
ARP: Destination Protocol Address = 40.1.1.5
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---


ETHER: ---- Ethernet Header ----
ETHER:
ETHER: Destination = 00:1B:21:7D:57:BB
ETHER: Source      = 00:15:17:C8:90:29
ETHER: Type        = 0x0806 (ARP)
ETHER:
ARP: ---- ARP Packet ----
ARP:
ARP: Hardware Type                = Ethernet (0x0001)
ARP: Protocol Type                = DOD IP (0x0800)
ARP: Hardware Address Length      = 6
ARP: Protocol Address Length      = 4
ARP: Function                     = Response (0x0002)
ARP: Source Hardware Address      = 00:15:17:C8:90:29
ARP: Source Protocol Address      = 40.1.1.5
ARP: Destination Hardware Address = 00:1B:21:7D:57:BB
ARP: Destination Protocol Address = 40.1.1.150
ARP:
ARP: ---- End ARP Packet ----
ARP:
ETHER: --- Padding [18 bytes] ---
ETHER:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
ETHER:  00 00                                             ..
ETHER: --- Padding End ---

IP DUT is still alive at: 00:15:17:C8:90:29
<< IPSEC-ESP-26.7: Passed
Executing system command:
  "./DocScriptQ35/IPSEC-ESP/IPSECESPpostsuite.exp $ANVL_DUTHOSTNAME"
spawn telnet 128.224.166.238
Trying 128.224.166.238...
Connected to 128.224.166.238.
Escape character is '^]'.

-> cmd sysvar set -co ipnet.inet.AcceptSourceRoute "0"
sysvar: ipnet.inet.AcceptSourceRoute=0 ok
-> cmd keyadm flush
SADB_MSG: msgtype=FLUSH  err=0  satype=NONE  len=16  seq=2073  pid=0x5de180
------------------------------------------
-> ipDetach 0,"gei"
value = 0 = 0x0
-> ipDetach 1,"gei"
value = 0 = 0x0
-> exit
Au revoir!
Connection closed by foreign host.

Number of tests run:          9
Number of tests passed:       9
Number of tests failed:       0
Number of tests inconclusive: 0
